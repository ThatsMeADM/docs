---
api: "POST /api/v1.0/invitations"
title: "Emitir Certificados"
---

Emite um ou mais certificados, vinculados a um **evento** e a uma **badge**, para um ou vários destinatários.

O certificado é criado com status `PENDING` e se torna `ACCEPTED` após o destinatário aceitar.

<Request method="POST" url="/api/v1.0/invitations" auth="bearer" />

<Note>
  Toda emissão está vinculada a um evento e a uma badge.

  - Use `GET /api/v1.0/events` para localizar o `event_id`
  - Use `GET /api/v1.0/badges` para localizar o `badge_id`
</Note>

---

## Parâmetros do corpo (body)

<ParamField body="event_id" type="string" required>
  ID do evento vinculado à emissão.
</ParamField>

<ParamField body="badge_id" type="string" required>
  ID do badge utilizado na emissão.
</ParamField>

<ParamField body="recipient" type="object">
  Destinatário único ou array de destinatários. Quando informado, `recipient_name` e `recipient_email` no nível raiz não são obrigatórios.

  Cada item pode conter: `recipient_name` (obrigatório), `recipient_email` (obrigatório), `recipient_number` (opcional, E.164), `reason` (opcional).
</ParamField>

<ParamField body="recipient_name" type="string">
  Nome completo do destinatário. Obrigatório quando `recipient` não for informado.
</ParamField>

<ParamField body="recipient_email" type="string">
  E-mail do destinatário que receberá o convite. Obrigatório quando `recipient` não for informado.
</ParamField>

<ParamField body="recipient_number" type="string">
  Número do destinatário para notificações por SMS ou WhatsApp (formato E.164). 
  _Exemplo:_ +5531987654321.
</ParamField>

<ParamField body="reason" type="string">
  Motivo pelo qual o destinatário está recebendo o certificado. Opcional. Quando usado com `recipient`, pode ser definido por destinatário dentro de cada item.
</ParamField>

<Info>
  É obrigatório informar **recipient** (objeto ou array) **ou** o par **recipient_name** e **recipient_email**. A emissão de múltiplos certificados consome créditos por destinatário.
</Info>

---

## Resposta

**Emissão de um único destinatário (sem erros):**

<ResponseField name="invitation_id" type="string">
  Identificador único do certificado/convite criado.
</ResponseField>

<ResponseField name="message" type="string">
  Mensagem de confirmação da emissão.
</ResponseField>

<ResponseField name="created_at" type="string">
  Data e hora da emissão (ISO 8601).
</ResponseField>

**Emissão de múltiplos destinatários ou com erros parciais:**

<ResponseField name="invitations" type="array">
  Lista dos certificados emitidos com sucesso. Cada item contém `invitation_id` e `created_at`.
</ResponseField>

<ResponseField name="message" type="string">
  Mensagem de confirmação (inclui quantidade de sucessos e, se houver, de falhas).
</ResponseField>

<ResponseField name="total" type="number">
  Quantidade de certificados emitidos com sucesso.
</ResponseField>

<ResponseField name="success_count" type="number">
  Quantidade de certificados emitidos com sucesso.
</ResponseField>

<ResponseField name="errors" type="array">
  Quando há falhas por destinatário: lista com `recipient_email` e `error` por item.
</ResponseField>

<ResponseField name="error_count" type="number">
  Quantidade de destinatários que falharam (presente quando `errors` existe).
</ResponseField>

<Info>
  Por privacidade, a resposta não retorna dados pessoais do destinatário. 
  O acompanhamento do aceite deve ser feito via `GET /api/v1.0/invitations`.
</Info>

---

## Exemplo de resposta (um destinatário)

<ResponseExample>

```json Response (201)
{
  "invitation_id": "invite_123",
  "message": "Certificado emitido com sucesso",
  "created_at": "2024-02-01T10:30:00Z"
}
```

</ResponseExample>

---

## Exemplo de resposta (múltiplos destinatários)

<ResponseExample>

```json Response (201)
{
  "invitations": [
    { "invitation_id": "invite_123", "created_at": "2024-02-01T10:30:00Z" },
    { "invitation_id": "invite_456", "created_at": "2024-02-01T10:31:00Z" }
  ],
  "message": "2 certificado(s) emitido(s) com sucesso",
  "total": 2,
  "success_count": 2
}
```

</ResponseExample>

---

## Exemplo de resposta (sucesso parcial)

<ResponseExample>

```json Response (201)
{
  "invitations": [
    { "invitation_id": "invite_123", "created_at": "2024-02-01T10:30:00Z" }
  ],
  "message": "1 certificado(s) emitido(s) com sucesso. 1 destinatário(s) falharam.",
  "total": 1,
  "success_count": 1,
  "errors": [
    { "recipient_email": "duplicado@email.com", "error": "Já existe uma emissão para este destinatário neste evento com esta badge e motivo." }
  ],
  "error_count": 1
}
```

</ResponseExample>

---

## Erros comuns

### Evento inexistente, finalizado ou não pertencente ao emissor

<ResponseExample>

```json Response (404)
{
  "error": "EVENT_NOT_FOUND",
  "message": "Evento não encontrado, finalizado ou não pertence ao emissor autenticado."
}
```

</ResponseExample>

### Badge inexistente ou não pertencente ao emissor

<ResponseExample>

```json Response (404)
{
  "error": "BADGE_NOT_FOUND",
  "message": "Badge não encontrado ou não pertence ao emissor autenticado."
}
```

</ResponseExample>

### Certificado já emitido para o mesmo destinatário

<ResponseExample>

```json Response (409)
{
  "error": "INVITATION_ALREADY_EXISTS",
  "message": "Já existe uma emissão para este destinatário neste evento com esta badge e motivo."
}
```

</ResponseExample>

### Dados inválidos ou ausentes

<ResponseExample>

```json Response (400)
{
  "error": "VALIDATION_ERROR",
  "message": "Campos obrigatórios ausentes: recipient ou recipient_name/recipient_email são obrigatórios."
}
```

</ResponseExample>

### Erro ao processar todos os destinatários

<ResponseExample>

```json Response (400)
{
  "error": "PROCESSING_ERROR",
  "message": "Erro ao processar todos os destinatários",
  "errors": [
    { "recipient_email": "email@exemplo.com", "error": "Mensagem do erro" }
  ]
}
```

</ResponseExample>

### Saldo insuficiente para emissão

<ResponseExample>

```json Response (402)
{
  "error": "INSUFFICIENT_BALANCE",
  "message": "Saldo insuficiente para realizar a emissão de N certificado(s)."
}
```

</ResponseExample>

<Note>
  A emissão consome créditos no momento da criação do certificado.\
  Caso o saldo seja insuficiente, a emissão não é realizada.
</Note>